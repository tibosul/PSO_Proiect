#
# DHCPv4 Server Configuration File
# /etc/dhcp/dhcpd.conf
#
# This file contains the configuration for the ISC DHCP server.
# See dhcpd.conf(5) man page for more information about the syntax.
#
# If this DHCP server is the official DHCP server for the local
# network, the authoritative directive should be uncommented.
#

#########################################################################
# Global Configuration Parameters
#########################################################################

# This server is authoritative for all networks it serves
# This means it will send DHCPNAK to clients that request invalid leases
authoritative;

# Default and maximum lease times (in seconds)
# These apply to all subnets unless overridden at the subnet level
default-lease-time 7200;        # 2 hours
max-lease-time 86400;           # 24 hours

# Dynamic DNS updates
# Options: none, interim, ad-hoc, standard
# 'none' means DHCP server won't perform DNS updates
ddns-update-style none;

# Ping check - verify IP is not already in use before offering it
# This adds latency but prevents IP conflicts
# NOTE: Disable for loopback testing (all 127.x.x.x respond to ping)
ping-check true;
ping-timeout 2;                 # Seconds to wait for ping response

# Global DNS servers (fallback for all subnets)
# Primary: Google DNS, Secondary: Cloudflare DNS
option domain-name-servers 8.8.8.8, 8.8.4.4, 1.1.1.1;

#########################################################################
# Global Time and Server Options (with subnet override support)
#########################################################################
# These options can be set globally as fallbacks and overridden per subnet
#
# NTP Servers (DHCP option 42) - Network Time Protocol for time synchronization
# Recommended: Use reliable public NTP servers or local time server
# option ntp-servers 192.168.1.1, 129.6.15.28, 132.163.96.1;
#
# NetBIOS Name Servers (DHCP option 44) - For Windows networking (WINS servers)
# Only needed for legacy Windows networks or mixed environments
# option netbios-name-servers 192.168.1.2;
#
# Time Offset (DHCP option 2) - Offset from UTC in seconds
# Examples: 0 = UTC, 3600 = UTC+1 (CET), -18000 = UTC-5 (EST), 7200 = UTC+2 (EET)
# option time-offset 0;

#########################################################################
# PXE Boot Configuration (Network Booting)
#########################################################################
# Uncomment these if you need PXE boot support for network installations
# or diskless workstations
#
# next-server: IP of the TFTP server that hosts boot files
# filename: Name of the boot file to download (e.g., pxelinux.0, bootx64.efi)
#
# next-server 192.168.1.10;
# filename "pxelinux.0";
#
# Alternative: Use DHCP options 66 and 67 (some clients prefer these)
# option tftp-server-name "192.168.1.10";
# option bootfile-name "pxelinux.0";

#########################################################################
# Lease Renewal Timers (T1 and T2)
#########################################################################
# These control when clients attempt to renew their DHCP leases
# Recommended: T1 = 50% of lease time, T2 = 87.5% of lease time
#
# T1 (Renewal Time - Option 58): Client tries to renew with same server
# T2 (Rebinding Time - Option 59): Client broadcasts to any server
#
# Example for default-lease-time of 7200 seconds (2 hours):
# option dhcp-renewal-time 3600;     # T1 = 1 hour (50%)
# option dhcp-rebinding-time 6300;   # T2 = 1h 45min (87.5%)

#########################################################################
# Server Behavior Control
#########################################################################
# Control which clients are allowed to receive IP addresses
#
# allow unknown-clients: Permits any client to get an IP (default behavior)
# deny unknown-clients: Only clients with host reservations get IPs
#
# allow unknown-clients;  # Default - anyone can get an IP
#
# deny unknown-clients;   # Uncomment for whitelist-only mode (secure networks)
#
# BOOTP is the predecessor to DHCP. Modern networks typically don't need it.
# allow bootp;            # Default - accept BOOTP requests (legacy support)
# deny bootp;             # Uncomment to reject BOOTP, accept only DHCP

# Log facility for syslog
# Options: local0 through local7, daemon, user
# log-facility local7;

# If both allow and deny statements are present, deny takes precedence.
# This applies to unknown-clients, bootp, and other access control directives.
# If none are specified, all clients are allowed by default and BOOTP is accepted.

# Update conflict detection
# If a client sends a DHCPDISCOVER that includes a requested IP address
# that conflicts with an active lease, the server can be configured to
# do conflict detection before offering the address.
# update-conflict-detection false;

#########################################################################
# Loopback Test Network (for local testing only)
#########################################################################
# This subnet allows testing on localhost without a real network
# Network: 127.0.0.0/8
# DHCP Range: 127.0.0.100 - 127.0.0.200
#

subnet 127.0.0.0 netmask 255.0.0.0 {
    range 127.0.0.100 127.0.0.200;
    option routers 127.0.0.1;
    option subnet-mask 255.0.0.0;
    option broadcast-address 127.255.255.255;
    option domain-name "localhost";
    option domain-name-servers 127.0.0.1;
    default-lease-time 300;
    max-lease-time 600;
}

#########################################################################
# Production Network - Corporate LAN
#########################################################################
# Main office network for employees and infrastructure
# Network: 192.168.1.0/24
# Gateway: 192.168.1.1
# DHCP Range: 192.168.1.100 - 192.168.1.200
#

subnet 192.168.1.0 netmask 255.255.255.0 {
    # IP address range for dynamic allocation
    range 192.168.1.100 192.168.1.200;

    # Default gateway (router)
    option routers 192.168.1.1;

    # Subnet mask to be sent to clients
    option subnet-mask 255.255.255.0;

    # Broadcast address for this subnet
    option broadcast-address 192.168.1.255;

    # Domain name for this subnet
    option domain-name "corporate.example.com";

    # DNS servers specific to this subnet
    # Primary: Local DNS, Secondary: External fallbacks
    option domain-name-servers 192.168.1.2, 8.8.8.8, 1.1.1.1;

    # NTP servers for time synchronization
    # RFC 2132 - Option 42
    # Note: Use IP addresses, not hostnames (parser limitation)
    option ntp-servers 192.168.1.1, 129.6.15.28;

    # NetBIOS name servers (for Windows networking)
    # RFC 2132 - Option 44
    option netbios-name-servers 192.168.1.2;

    # NetBIOS node type
    # 1 = B-node (broadcast), 2 = P-node (peer), 4 = M-node (mixed), 8 = H-node (hybrid)
    # option netbios-node-type 8;

    # Time offset from UTC in seconds
    # 0 = UTC, 3600 = UTC+1, -18000 = EST (UTC-5)
    option time-offset 0;

    # Lease times can be overridden per subnet
    default-lease-time 28800;    # 8 hours for corporate
    max-lease-time 86400;        # 24 hours max

    #####################################################################
    # Static Host Reservations - Infrastructure Servers
    #####################################################################

    # Primary domain controller
    host dc01 {
        hardware-ethernet 00:11:22:33:44:55;
        fixed-address 192.168.1.10;
        option host-name "dc01";
    }

    # Secondary domain controller (backup)
    host dc02 {
        hardware-ethernet 00:11:22:33:44:56;
        fixed-address 192.168.1.11;
        option host-name "dc02";
    }

    # File server
    host fileserver01 {
        hardware-ethernet 00:11:22:33:44:57;
        fixed-address 192.168.1.15;
        option host-name "fileserver01";
    }

    # Database server
    host db-prod {
        hardware-ethernet 00:11:22:33:44:58;
        fixed-address 192.168.1.20;
        option host-name "db-prod";
    }

    # Network printer (HP LaserJet)
    host printer-accounting {
        hardware-ethernet 00:11:22:33:44:59;
        fixed-address 192.168.1.50;
        option host-name "printer-accounting";
    }

    # Network printer (Brother Color)
    host printer-marketing {
        hardware-ethernet 00:11:22:33:44:5a;
        fixed-address 192.168.1.51;
        option host-name "printer-marketing";
    }
}

#########################################################################
# Guest WiFi Network
#########################################################################
# Isolated network for guests and visitors
# Network: 10.0.0.0/24
# Gateway: 10.0.0.1
# DHCP Range: 10.0.0.50 - 10.0.0.200
#

subnet 10.0.0.0 netmask 255.255.255.0 {
    # Larger range for many concurrent guests
    range 10.0.0.50 10.0.0.200;

    option routers 10.0.0.1;
    option subnet-mask 255.255.255.0;
    option broadcast-address 10.0.0.255;
    option domain-name "guest.example.com";

    # Only external DNS servers for guests (no internal resources)
    option domain-name-servers 8.8.8.8, 1.1.1.1;

    option time-offset 0;

    # Shorter lease times for guest network (high churn)
    default-lease-time 1800;     # 30 minutes
    max-lease-time 3600;         # 1 hour maximum
}

#########################################################################
# IoT and Smart Devices Network
#########################################################################
# Separate network for IoT devices, cameras, sensors
# Network: 10.10.0.0/24
# Gateway: 10.10.0.1
# DHCP Range: 10.10.0.100 - 10.10.0.250
#

subnet 10.10.0.0 netmask 255.255.255.0 {
    range 10.10.0.100 10.10.0.250;

    option routers 10.10.0.1;
    option subnet-mask 255.255.255.0;
    option broadcast-address 10.10.0.255;
    option domain-name "iot.example.com";
    option domain-name-servers 192.168.1.2, 8.8.8.8;

    # IoT devices typically don't change, so longer leases
    default-lease-time 86400;    # 24 hours
    max-lease-time 604800;       # 7 days

    # Security cameras (static reservations for monitoring)
    host camera-entrance {
        hardware-ethernet aa:bb:cc:dd:ee:01;
        fixed-address 10.10.0.10;
        option host-name "camera-entrance";
    }

    host camera-parking {
        hardware-ethernet aa:bb:cc:dd:ee:02;
        fixed-address 10.10.0.11;
        option host-name "camera-parking";
    }

    host camera-warehouse {
        hardware-ethernet aa:bb:cc:dd:ee:03;
        fixed-address 10.10.0.12;
        option host-name "camera-warehouse";
    }

    # Smart thermostat
    host thermostat-main {
        hardware-ethernet aa:bb:cc:dd:ee:10;
        fixed-address 10.10.0.20;
        option host-name "thermostat-main";
    }

    # Access control system
    host access-controller {
        hardware-ethernet aa:bb:cc:dd:ee:20;
        fixed-address 10.10.0.30;
        option host-name "access-controller";
    }
}

#########################################################################
# VoIP Phone Network (VLAN 100)
#########################################################################
# Dedicated network for VoIP phones
# Network: 172.16.100.0/24
# Gateway: 172.16.100.1
# DHCP Range: 172.16.100.50 - 172.16.100.200
#

subnet 172.16.100.0 netmask 255.255.255.0 {
    range 172.16.100.50 172.16.100.200;

    option routers 172.16.100.1;
    option subnet-mask 255.255.255.0;
    option broadcast-address 172.16.100.255;
    option domain-name "voip.example.com";
    option domain-name-servers 192.168.1.2, 8.8.8.8;

    # NTP is critical for VoIP (call timing)
    option ntp-servers 192.168.1.1;

    # TFTP server for phone firmware and config (Option 66)
    # option tftp-server-name "tftp.example.com";

    # SIP proxy server (vendor-specific option)
    # option sip-servers 172.16.100.10;

    # Standard lease times for phones
    default-lease-time 43200;    # 12 hours
    max-lease-time 86400;        # 24 hours

    # Conference room phones
    host phone-conf-room-a {
        hardware-ethernet 11:22:33:44:55:01;
        fixed-address 172.16.100.10;
        option host-name "phone-conf-room-a";
    }

    host phone-conf-room-b {
        hardware-ethernet 11:22:33:44:55:02;
        fixed-address 172.16.100.11;
        option host-name "phone-conf-room-b";
    }

    # Reception desk phone
    host phone-reception {
        hardware-ethernet 11:22:33:44:55:10;
        fixed-address 172.16.100.20;
        option host-name "phone-reception";
    }
}

#########################################################################
# Development/Testing Network
#########################################################################
# Network for developers and test environments
# Network: 192.168.50.0/24
# Gateway: 192.168.50.1
# DHCP Range: 192.168.50.100 - 192.168.50.200
#

subnet 192.168.50.0 netmask 255.255.255.0 {
    range 192.168.50.100 192.168.50.200;

    option routers 192.168.50.1;
    option subnet-mask 255.255.255.0;
    option broadcast-address 192.168.50.255;
    option domain-name "dev.example.com";
    option domain-name-servers 192.168.50.2, 8.8.8.8;

    # Shorter leases for dev environment (machines come and go)
    default-lease-time 3600;     # 1 hour
    max-lease-time 14400;        # 4 hours

    # Development servers
    host dev-web01 {
        hardware-ethernet de:ad:10:00:00:01;
        fixed-address 192.168.50.10;
        option host-name "dev-web01";
    }

    host dev-db01 {
        hardware-ethernet de:ad:10:00:00:02;
        fixed-address 192.168.50.11;
        option host-name "dev-db01";
    }

    host jenkins-ci {
        hardware-ethernet de:ad:10:00:00:10;
        fixed-address 192.168.50.20;
        option host-name "jenkins-ci";
    }
}

#########################################################################
# DMZ Network (Demilitarized Zone)
#########################################################################
# Public-facing servers (web servers, mail servers)
# Network: 203.0.113.0/28 (example public subnet)
# Gateway: 203.0.113.1
# DHCP Range: 203.0.113.5 - 203.0.113.10
#
# Note: In production, DMZ servers usually have static IPs configured
# manually, but DHCP can be used for initial provisioning or PXE boot
#

subnet 203.0.113.0 netmask 255.255.255.240 {
    # Small range - most servers here will have static reservations
    range 203.0.113.5 203.0.113.10;

    option routers 203.0.113.1;
    option subnet-mask 255.255.255.240;
    option broadcast-address 203.0.113.15;
    option domain-name "example.com";

    # External DNS servers only (no internal DNS access from DMZ)
    option domain-name-servers 8.8.8.8, 1.1.1.1;

    # Very long lease times (these servers rarely restart)
    default-lease-time 259200;   # 3 days
    max-lease-time 604800;       # 7 days

    # Web server (public website)
    host web-public {
        hardware-ethernet aa:bb:cc:00:11:01;
        fixed-address 203.0.113.2;
        option host-name "web-public";
    }

    # Mail server
    host mail-public {
        hardware-ethernet aa:bb:cc:00:11:02;
        fixed-address 203.0.113.3;
        option host-name "mail-public";
    }

    # VPN gateway
    host vpn-gateway {
        hardware-ethernet aa:bb:cc:00:11:03;
        fixed-address 203.0.113.4;
        option host-name "vpn-gateway";
    }
}

#########################################################################
# PXE Boot / Network Installation Subnet
#########################################################################
# Special configuration for PXE booting and network installations
# Uncomment if you need PXE boot support
#

# subnet 192.168.99.0 netmask 255.255.255.0 {
#     range 192.168.99.100 192.168.99.200;
#
#     option routers 192.168.99.1;
#     option subnet-mask 255.255.255.0;
#     option broadcast-address 192.168.99.255;
#
#     # TFTP server for PXE boot files
#     next-server 192.168.99.10;
#     filename "pxelinux.0";
#
#     # Alternative using option 66 and 67
#     # option tftp-server-name "192.168.99.10";
#     # option bootfile-name "pxelinux.0";
#
#     default-lease-time 600;      # 10 minutes (short for installation)
#     max-lease-time 1800;         # 30 minutes max
# }

#########################################################################
# Failover Configuration (commented out - for future implementation)
#########################################################################
# DHCP failover provides redundancy with a peer DHCP server
# Requires both servers to be configured with matching failover stanzas
#

# failover peer "dhcp-failover" {
#     primary;                                    # This server is primary
#     address 192.168.1.5;                        # Primary server IP
#     port 519;                                   # Failover port
#     peer address 192.168.1.6;                   # Secondary server IP
#     peer port 520;                              # Peer failover port
#     max-response-delay 60;                      # Seconds
#     max-unacked-updates 10;                     # Number of updates
#     load balance max seconds 3;                 # Load balancing
#     mclt 3600;                                  # Maximum Client Lead Time
#     split 128;                                  # 50/50 split of addresses
# }

#########################################################################
# Class Declarations (commented out - for advanced scenarios)
#########################################################################
# Classes allow grouping clients by characteristics and applying
# different configurations based on vendor, user-class, etc.
#

# # Class for Windows clients
# class "windows-clients" {
#     match if substring (option vendor-class-identifier, 0, 4) = "MSFT";
# }
#
# # Class for Linux clients
# class "linux-clients" {
#     match if substring (option vendor-class-identifier, 0, 5) = "Linux";
# }
#
# # Class for Cisco IP phones
# class "cisco-phones" {
#     match if substring (option vendor-class-identifier, 0, 5) = "Cisco";
# }

#########################################################################
# Advanced Options (commented out - for reference)
#########################################################################

# # Option 119 - Domain Search List (RFC 3397)
# # Provides a list of domain suffixes for DNS resolution
# # option domain-search "example.com", "corp.example.com";

# # Option 121 - Classless Static Routes (RFC 3442)
# # Allows pushing static routes to clients
# # Format: destination_descriptor, router_address
# # option classless-static-routes 24, 192,168,2, 192,168,1,254;

# # Option 252 - WPAD (Web Proxy Auto-Discovery)
# # URL to proxy auto-config file
# # option wpad-url code 252 = text;
# # option wpad-url "http://proxy.example.com/wpad.dat";

# # Vendor-specific options (Option 43)
# # Used for vendor-specific configuration data
# # option vendor-encapsulated-options 01:04:c0:a8:01:0a;

#########################################################################
# Security Notes
#########################################################################
#
# 1. Always use 'authoritative' on your official DHCP server
# 2. Keep lease times reasonable (not too short, not too long)
# 3. Use separate subnets/VLANs for different security zones
# 4. Regularly review and clean up static reservations
# 5. Monitor DHCP pool exhaustion
# 6. Consider implementing DHCP snooping on switches
# 7. Log DHCP events for security auditing
# 8. Backup your lease database regularly
#
#########################################################################

# End of dhcpd.conf
